///|
// Logger for Mocket framework
pub struct Logger {
  enabled : Bool
  level : LogLevel
}

///|
pub enum LogLevel {
  Debug
  Info
  Warn
  Error
}

///|
// ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–ï¼šå®Œå…¨ç¦ç”¨æ—¥å¿—ä»¥è·å¾—é›¶å¼€é”€
pub fn new_logger(enabled? : Bool = true, level? : LogLevel = Debug) -> Logger {
  { enabled, level }
}

///|
// ç”Ÿäº§ç¯å¢ƒä¸“ç”¨ï¼šé›¶å¼€é”€loggerï¼ˆç¼–è¯‘æ—¶ä¼˜åŒ–ï¼‰
pub fn new_production_logger() -> Logger {
  { enabled: false, level: Error }
}

///|
// å¼€å‘ç¯å¢ƒä¸“ç”¨ï¼šå…¨åŠŸèƒ½logger
pub fn new_debug_logger() -> Logger {
  { enabled: true, level: Debug }
}

///|
// é›¶æˆæœ¬æŠ½è±¡ï¼šä½¿ç”¨lazy evaluationé¿å…ä¸å¿…è¦çš„å­—ç¬¦ä¸²æ„é€ 
pub fn debug(self : Logger, message_fn : () -> String) -> Unit {
  if self.enabled && self.level_allows(Debug) {
    println("ğŸ› [DEBUG] \{message_fn()}")
  }
}

///|
pub fn info(self : Logger, message_fn : () -> String) -> Unit {
  if self.enabled && self.level_allows(Info) {
    println("â„¹ï¸  [INFO] \{message_fn()}")
  }
}

///|
pub fn warn(self : Logger, message_fn : () -> String) -> Unit {
  if self.enabled && self.level_allows(Warn) {
    println("âš ï¸  [WARN] \{message_fn()}")
  }
}

///|
pub fn error(self : Logger, message_fn : () -> String) -> Unit {
  if self.enabled && self.level_allows(Error) {
    println("âŒ [ERROR] \{message_fn()}")
  }
}

///|
// ä¾¿åˆ©æ–¹æ³•ï¼šç›´æ¥ä¼ å­—ç¬¦ä¸²ï¼ˆæ€§èƒ½ç¨å·®ä½†ä½¿ç”¨ç®€å•ï¼‰
pub fn debug_str(self : Logger, message : String) -> Unit {
  if self.enabled && self.level_allows(Debug) {
    println("ğŸ› [DEBUG] \{message}")
  }
}

///|
fn level_allows(self : Logger, target_level : LogLevel) -> Bool {
  match (self.level, target_level) {
    (Debug, _) => true
    (Info, Info) | (Info, Warn) | (Info, Error) => true
    (Warn, Warn) | (Warn, Error) => true
    (Error, Error) => true
    _ => false
  }
}

///|
// è·¯ç”±ç›¸å…³çš„ä¸“ç”¨æ—¥å¿—æ–¹æ³• - é›¶æˆæœ¬æŠ½è±¡ç‰ˆæœ¬
pub fn route_register(self : Logger, method_ : String, path : String) -> Unit {
  self.debug(fn() { "ğŸ”§ Registering route: \{method_} \{path}" })
}

///|
pub fn route_static(self : Logger, method_ : String, path : String) -> Unit {
  self.debug(fn() { "ğŸ“Œ Static route: \{method_} \{path}" })
}

///|
pub fn route_dynamic(self : Logger, method_ : String, path : String) -> Unit {
  self.debug(fn() { "ğŸ¯ Dynamic route: \{method_} \{path}" })
}

///|
pub fn route_lookup(self : Logger, method_ : String, path : String) -> Unit {
  self.debug(fn() { "ğŸ” Looking for route: \{method_} \{path}" })
}

///|
pub fn route_found(self : Logger, method_ : String, path : String) -> Unit {
  self.debug(fn() { "âœ… Found static route match!" })
  self.debug(fn() { "ğŸ“ Request: \{method_} \{path}" })
}

///|
pub fn route_not_found(self : Logger, path : String) -> Unit {
  self.debug(fn() { "âŒ No static route match for \{path}" })
}

///|
pub fn routes_available(self : Logger, routes : Array[String]) -> Unit {
  self.debug(fn() { "ğŸ“‹ Found method routes" })
  self.debug(fn() { "ğŸ—‚ï¸ Available static routes:" })
  routes.iter().each(fn(route) { self.debug(fn() { "  - \{route}" }) })
}

///|
pub fn route_merge_existing(self : Logger, method_ : String) -> Unit {
  self.debug(fn() { "ğŸ“ Adding to existing method routes for \{method_}" })
}

///|
pub fn route_merge_new(self : Logger, method_ : String) -> Unit {
  self.debug(fn() { "ğŸ†• Creating new method routes for \{method_}" })
}

///|
pub fn route_added(self : Logger, path : String) -> Unit {
  self.debug(fn() { "âœ… Added \{path} to existing routes" })
}

///|
pub fn route_created(self : Logger, path : String) -> Unit {
  self.debug(fn() { "âœ… Created new routes and added \{path}" })
}
